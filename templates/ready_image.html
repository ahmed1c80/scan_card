<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> 
    بوابة الخدمة الالكترونية
    شاجره للصرافة والتحويلات
    </title>
    <link rel="stylesheet" href="styles.css">
<script sr="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/4.6.2/css/bootstrap.min.css">

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>


<script sr="https://cdn.jsdelivr.net/gh/c-kick/mobileConsole/hnl.mobileconsole.min.js"></script>


<style>
     .seat-rating-fee .seat-rating {
    font-size: 11px;
    color: rgba(0, 0, 0, 0.3);
    font-weight: 600;
    height: 100%;
}

a, a:hover, a:focus {
    -webkit-transition-duration: 500ms;
    transition-duration: 500ms;
    text-decoration: none;
    outline: 0 solid transparent;
    color: #009583;
    font-weight: 600;
    font-size: 14px;
}
</style>
  <style>
  {% include 'accounts/style_pattern.html' %}

</style>
   <script sr="faceapi/face-api.js"></script>
</head>
<body>
  
        <header class="header">
        <div class="row align-items-center">
            <!-- Image Column -->
            <div class="col-2 text-center">
                <img  src="url('uploads/')/sh.png" alt="Profile" class="img-fluid rounded-circle logo" width="50">
            </div>
            <!-- Name Column -->
            <div class="col text-right" style="background:re">
                <h3 class="mb-0" style="font-size:12px"> 
                شركة شاجره للصرافة والتحويلات
                </h3>
                <p class="text-muted">
                بوابة الخدمة الالكترونية
                </p>
            </div>
            
            <div class="col-4 text-right" style="background:re">
                
                <div class="seat-rating h-100 d-flex align-items-center">
                                <div class="rating toolbar clearfix">
                <a href="url('account')" data-target="#login-box" class="btn btn-sm btn-success">  
                تسجيل الدخول
                </a>
            </div>
                            </div>
            </div>
            
        </div>
        </header>
        <br><br>
          <div class=" sect sect--padding-top">

                  <div class="container">
                      

        <section class="form-section" style="margin:auto">
            <h3 style="text-align:right">شاشة التسجيل</h3>
            <p>يرجى كتابة اسمك باللغة العربية كما هو مدون في الهوية الشخصية</p>
            
    <div clas="form-container">
       
        <form id="registrationForm" enctype="multipart/form-data" action="url('request/')" method="post">
                       
                                   		  
                                   		  
                                   		  
                          <label for="account_type">
                              نوع الحساب:</label>
        <select name="account_type" id="account_type" class='form-control'>
            <option value="0">
                فردي
            </option>
            <option value="1">
                شركة
            </option>
            <option value="2">
                جمعية
            </option>
        </select>         		  
                                   		  
                         <label for="purpose">
                         الغرض من فتح
                         الحساب:
   <strong>
       

         (اختياري)
                         </strong>   </label>
                         
        <textarea name="purpose" id="purpose" class="form-control"></textarea>
        
                                   		  
                                   		  
            <label for="firstName">الاسم الأول:</label>
            <input type="text" id="firstName" name="first_name" required class='form-control'>

            <label for="middleName">اسم الأب والجد:</label>
            <input type="text" id="middleName" name="middle_name" required class='form-control'>

            <label for="lastName">اللقب:</label>
            <input type="text" id="lastName" name="last_name" required class='form-control'>
       
                    
            <label for="phoneNumber">رقم الهاتف:</label>
     
            <div class="phone-container">
            
   

                        <input type="tel" id="phoneNumber" class="form-control" name="phone_number" placeholder="7********" required>

                           
     
                <select id="countryCode" name="country_code" class='form-control'>
                                      <option value="+967">+967 YEM</option>
                    <option value="+971">+971 UAE</option>
                    <option value="+966">+966 KSA</option>
                    <option value="+20">+20 EGP</option>
                    <option value="+1">+1 USA</option>
                </select>
                
            
            </div>

            <label for="gender">الجنس:</label>
            <select id="gender" name="gender" required class='form-control'>
                <option value="male">ذكر</option>
                <option value="female">أنثى</option>
            </select>


            <label for="id_card"> الرقم الوطني:</label>
            <input type="text" id="id_card" name="id_card" required class='form-control'>
            


        {% include 'accounts/form_cards.html' %}
        
        {% include 'accounts/face.html' %}
{% include 'accounts/signatur.html' %}


{% include 'accounts/terms.html' %}



            <button class="btn btn-sm btn-primary" type="submit">إنشاء الحساب</button>
        </form>
        
 
      


        
        
        
        <div id="loadingIndicator2" class="progress_hidden">
            

<div id="loadingIndicator" st="display:none;">
    <div class="spinner"></div>
    <p>جاري معالجة البيانات...</p>
</div>
        </div>
    </div>
    
    
    <script src="https://cdn.jsdelivr.net/npm/tesseract.js@2.1.5/dist/tesseract.min.js"></script>
    
    
    <div style="display:none">
        

    
    <pre id="result"></pre>

     </div>
     
    
    
    
    
    
     </section>
     </div>
                       </div>
     
     <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script sr="https://cdn.jsdelivr.net/npm/tesseract.js@v2.1.1/dist/tesseract.min.js"></script>




    <script>
    var text_front="";
    var text_passport="";
    try{
    $(document).ready(function(){
       $('#res_front').click(function(){

       });
    });
    }catch(e){
        alert(e+"");
    }
    const identityAndPassportKeywords = [
    // الإنجليزية
    "identity", "id", "passport", "national", "citizen", "citizenship", "driver's license", 
    "travel document", "residence permit", "permanent resident", 

    // العربية
    "بطاقة", "هوية", "جواز سفر", "إقامة", "مواطن", "جنسية", "رخصة قيادة", "وثيقة سفر", 

    // الفرنسية
    "identité", "passeport", "nationalité", "résident", "document de voyage", 

    // الإسبانية
    "identidad", "pasaporte", "nacionalidad", "residencia", "documento de viaje", 

    // الألمانية
    "identität", "reisepass", "staatsangehörigkeit", "aufenthaltserlaubnis", "dokument", 

    // الصينية (المبسطة)
    "身份证", "护照", "国籍", "居住证", "旅行证件", 

    // الروسية
    "удостоверение личности", "паспорт", "гражданство", "вид на жительство", "документ", 

    // الهندية
    "पहचान पत्र", "पासपोर्ट", "राष्ट्रीयता", "निवास", "यात्रा दस्तावेज़", 

    // البرتغالية
    "identidade", "passaporte", "nacionalidade", "residência", "documento de viagem", 

    // اليابانية
    "身分証明書", "パスポート", "国籍", "在留カード", "旅行証明書", 

    // لغات إضافية
    "tazkira", // أفغانستان
    "kartu tanda penduduk", // إندونيسيا
    "tarjeta de identidad", // كولومبيا
    "curp", // المكسيك
    "身份证号", // هونغ كونغ
    "身份证", // سنغافورة والصين
];

   var is_run_front=false;
    var is_run_passport=false;
    function previewImageIdFront(event) {
        const loadingIndicatorfront = document.getElementById("view_scan_front");
        const res_front = document.getElementById("res_front");
     
      const file = event.target.files[0];
        const previewfront = document.getElementById('previewfront');
        const placeholderfront = document.getElementById('placeholderfront');

        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('progress-bar-front').style.width = '0%';
                document.getElementById('progress-bar-front').textContent = '0%';
                res_front.textContent = '';
              $('.res_fro').html("");
                previewfront.src = e.target.result;
                previewfront.style.display = 'block';
                placeholderfront.style.display = 'none';
         //  $('.res_fro').html("");
          loadingIndicatorfront.classList.remove('progress_hidden')
          is_run_front=true;
          const image = reader.result;

try{
                      
                    // إنشاء كائن XMLHttpRequest
                    const xhr = new XMLHttpRequest();

                    // إعداد طلب AJAX
                    xhr.open('POST', '/analyze', true);
                    xhr.setRequestHeader('Content-Type', 'application/json');

                    // تتبع تقدم التحميل
                    xhr.upload.onprogress = function(event) {
                        if (event.lengthComputable) {
                          
                          const progress = Math.round(event.loaded / event.total) * 100;
                document.getElementById('progress-bar-front').style.width = progress + '%';
                document.getElementById('progress-bar-front').textContent = progress + '%';
                          
                          
                          
                           /* const percentComplete = (event.loaded / event.total) * 100;
                            $('#progressBar').val(percentComplete).text(percentComplete + '%');
                            */
                        }
                    };

                    // عند اكتمال التحميل
                    xhr.onload = function() {
                    // const response = JSON.parse(xhr.responseText);
                      alert(xhr.responseText);
                        if (xhr.status === 200) {
                           const response = JSON.parse(xhr.responseText);
                        var  text=response.text;
                            $('.res_fro').html(text);
                    
                        // عرض شريط التحميل
loadingIndicatorfront.classList.add("progress_hidden");

const lowercaseText = text.toLowerCase();

// التحقق مما إذا كان أي من الكلمات في المصفوفة موجودًا في النص
const containsKeyword = identityAndPassportKeywords.some(keyword => lowercaseText.includes(keyword.toLowerCase()));

if (containsKeyword) {
    console.log("Success: The text contains a valid keyword.");
    res_front.classList.remove('is-invalid');
                res_front.classList.add('is-valid');
                res_front.textContent = '✔';
                res_front.className = 'text-success fas fa-check'; // رمز النجاح
                is_run_front=false;
} else {
    
    res_front.classList.remove('is-valid');
                res_front.classList.add('is-invalid');
                res_front.textContent = '✖';
                res_front.className = 'text-danger fas fa-times'; // رمز الخطأ

    is_run_front=false;
}

                    document.getElementById('result').textContent = lowercaseText || "No text detected.";
                          
                          
                          
                          
                          
                          
                          
                           /* const response = JSON.parse(xhr.responseText);
                            $('#outputText').text(response.text);*/
                       
                       
                        } else {
                          is_run_front=false;
loadingIndicatorfront.classList.add("progress_hidden");
                    
                    document.getElementById('result').textContent = "Error analyzing text.";
      
                            alert('حدث خطأ أثناء معالجة الصورة: ' + JSON.stringify(xhr));
                        }
                        $('#progressBar').hide(); // إخفاء شريط التقدم بعد الانتهاء
                    };

                    // عند حدوث خطأ
                    xhr.onerror = function() {
                      is_run_front=false;
loadingIndicatorfront.classList.add("progress_hidden");
                   // console.error(error);
                    document.getElementById('result').textContent = "Error analyzing text.";
      
                        alert('حدث خطأ أثناء الاتصال بالخادم.');
                        $('#progressBar').hide();
                    };

                    // إرسال البيانات
                    xhr.send(JSON.stringify({ image: image }));

                    // إظهار شريط التقدم
                    $('#progressBar').show();
                
                // استخدام Tesseract لتحليل النصوص
                /*Tesseract.recognize(
                    image,
                    'eng+ara', // اللغة (يمكنك استخدام "ara" للغة العربية)
                    {
                        
                        logger: info =>{
                            
                            if (info.status === 'recognizing text') {
                const progress = Math.round(info.progress * 100);
                document.getElementById('progress-bar-front').style.width = progress + '%';
                document.getElementById('progress-bar-front').textContent = progress + '%';
            }
                        }
            //لعرض حالة التحليل
                    }
                ).then(({ data: { text } }) => {
                     $('.res_fro').html(text);
                    
                        // عرض شريط التحميل
loadingIndicatorfront.classList.add("progress_hidden");

const lowercaseText = text.toLowerCase();

// التحقق مما إذا كان أي من الكلمات في المصفوفة موجودًا في النص
const containsKeyword = identityAndPassportKeywords.some(keyword => lowercaseText.includes(keyword.toLowerCase()));

if (containsKeyword) {
    console.log("Success: The text contains a valid keyword.");
    res_front.classList.remove('is-invalid');
                res_front.classList.add('is-valid');
                res_front.textContent = '✔';
                res_front.className = 'text-success fas fa-check'; // رمز النجاح
                is_run_front=false;
} else {
    
    res_front.classList.remove('is-valid');
                res_front.classList.add('is-invalid');
                res_front.textContent = '✖';
                res_front.className = 'text-danger fas fa-times'; // رمز الخطأ

    is_run_front=false;
}

                    document.getElementById('result').textContent = lowercaseText || "No text detected.";
                    
                    
                }).catch(error => {
                   is_run_front=false;
loadingIndicatorfront.classList.add("progress_hidden");
                    console.error(error);
                    document.getElementById('result').textContent = "Error analyzing text.";
                });
                
                */
}catch(e){
    alert(e+"666");
}
            };
            reader.readAsDataURL(file);
        }
    }
    
    function previewImagepassportImage(event) {
       document.getElementById('progress-bar-pass').style.width =  '0%';
                document.getElementById('progress-bar-pass').textContent = '0%';
        const res_passport= document.getElementById("res_passport");
        const loadingIndicatorpassport= document.getElementById("view_scan_passport");
        const file = event.target.files[0];
        const previewpassport = document.getElementById('previewpassport');
        const placeholderpassport = document.getElementById('placeholderpassport');

        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                  is_run_passport=true;
                previewpassport.src = e.target.result;
                res_passport.textContent = '';
              $('.res_pass').html("");
           
                previewpassport.style.display = 'block';
                placeholderpassport.style.display = 'none';

          loadingIndicatorpassport.classList.remove('progress_hidden')
          const image = e.target.result;

                // استخدام Tesseract لتحليل النصوص
                Tesseract.recognize(
                    image,
                    'eng+ara', // اللغة (يمكنك استخدام "ara" للغة العربية)
                    {
                        logger: info =>{
                            if (info.status === 'recognizing text') {
                const progress = Math.round(info.progress * 100);
                document.getElementById('progress-bar-pass').style.width = progress + '%';
                document.getElementById('progress-bar-pass').textContent = progress + '%';
            }
                            console.log(info);
                        
                        // لعرض حالة التحليل
                    
                        }
                        }
                ).then(({ data: { text } }) => {
                    $('.res_pass').html(text);
                      is_run_passport=false;
                    const lowercaseText = text.toLowerCase();

// التحقق مما إذا كان أي من الكلمات في المصفوفة موجودًا في النص
const containsKeyword = identityAndPassportKeywords.some(keyword => lowercaseText.includes(keyword.toLowerCase()));

if (containsKeyword) {
    console.log("Success: The text contains a valid keyword.");
    res_passport.classList.remove('is-invalid');
                res_passport.classList.add('is-valid');
                res_passport.textContent = '✔';
                res_passport.className = 'text-success fas fa-check'; // رمز النجاح
                
} else {
    
    res_passport.classList.remove('is-valid');
                res_passport.classList.add('is-invalid');
                res_passport.textContent = '✖';
                res_passport.className = 'text-danger fas fa-times'; // رمز الخطأ

    
}

                    
                    
                        // عرض شريط التحميل
loadingIndicatorpassport.classList.add("progress_hidden");
                    document.getElementById('result').textContent = text || "No text detected.";
                }).catch(error => {
                     is_run_passport=false;
loadingIndicatorpassport.classList.add("progress_hidden");
                    console.error(error);
                    document.getElementById('result').textContent = "Error analyzing text.";
                });
                
            };
            reader.readAsDataURL(file);
        }
    }
    function previewImageIdBack(event) {
        const file = event.target.files[0];
        const preview = document.getElementById('previewback');
        const placeholder = document.getElementById('placeholderback');

        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                preview.src = e.target.result;
                preview.style.display = 'block';
                placeholder.style.display = 'none';
            };
            reader.readAsDataURL(file);
        }
    }
</script>

    <script>
        
        document.addEventListener("DOMContentLoaded", function () {
    const identityTypeSelect = document.getElementById("identityType");

    // Toggle identity inputs
    window.toggleIdentityInputs = function (value) {
        document.getElementById("idCardInputs").classList.toggle("hidden", value !== "id_card");
        document.getElementById("passportInputs").classList.toggle("hidden", value !== "passport");
    };
});


document.getElementById("registrationForm").addEventListener("submit", function (e) {
    e.preventDefault(); // منع الإرسال الافتراضي للنموذج
if(is_run_front||is_run_passport){
    alert('لم يكتمل فحص الهوية');
    return;
}
    const form = e.target;
    const formData = new FormData(form);


const loadingIndicator = document.getElementById("loadingIndicator2");

    // عرض شريط التحميل
loadingIndicator.classList.remove("progress_hidden");
    
    // إرسال الطلب باستخدام Fetch API
    fetch("/uploads", {
        method: 'POST',
        body: formData,
        headers: {
            'Accept': 'application/json',
        },
    })
    .then(response => response.json())
    .then(data => {
        // إخفاء شريط التحميل
        loadingIndicator.classList.add("progress_hidden");
        
        if (!data.success) {
            // عرض الأخطاء على الشاشة
            displayErrors(data.errors);
        } else {
            alert(data.message);
            form.reset(); // إعادة تعيين النموذج
     window.location.reload();

        }
    })
    .catch(error => {
        // إخفاء شريط التحميل
        loadingIndicator.classList.add("progress_hidden");
        alert(error);
        console.error('خطأ في الاتصال:', error);
    });
});

// وظيفة عرض الأخطاء
function displayErrors(errors) {
    // إزالة أي رسائل خطأ سابقة
    const errorElements = document.querySelectorAll(".error-message");
    errorElements.forEach(el => el.remove());

    // إضافة رسائل الخطأ الجديدة
    for (const [field, messages] of Object.entries(errors)) {
        const input = document.querySelector(`[name="${field}"]`);
        if (input) {
            const error = document.createElement("div");
            error.classList.add("error-message");
            error.style.color = "red";
            error.textContent = messages[0]; // عرض أول رسالة خطأ فقط
            input.insertAdjacentElement("afterend", error);
        }
    }
}

    </script>
    
{% include 'accounts/style.html' %}


<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
</body>
</html>